<h1>Subscribe</h1>

<div class="flex items-start w-full">
  <% if current_user.card_last4? %>
    <%= form_with url: subscription_path, local: true, id: "existing-card", class: "w-1/2" do |form| %>

      <div>
        <div><%= current_user.card_brand %> ending in <%= current_user.card_last4 %></div>
        <div>Expires <%= current_user.card_exp_month %> / <%= current_user.card_exp_year %></div>
        <%= link_to "Use a new card", "#", id: "use-new-card" %>
      </div>

      <%= form.hidden_field :plan_id, value: @plan.id %>
      <%= form.submit "Subscribe" %>
    <% end %>
  <% end %>

  <%= form_with url: subscription_path, local: true, id: "payment-form", class: "w-1/2 #{current_user.card_last4 ? "hidden" : "" }" do |form| %>
    <div class="flex flex-col flex-grow justify-start w-full">
      <label for="card-element">Credit or debit card</label>
      <div id="card-element" class="h-8 bg-white">
      </div>
      <div id="card-errors" role="alert">
      </div>

      <label>Name on Card</label>
      <%= form.text_field :name_on_card, id: "name_on_card", placeholder: "Full Name" %>

      <%= form.hidden_field :plan_id, value: @plan.id %>
      <%= form.submit "Subscribe" %>
    </div>
  <% end %>
  <div class="w-1/3">
    <h5><%= @plan.name %></h5>
    <h2><%= formatted_amount(@plan.amount) %></h2>
    <p class="text-xs">per <%= @plan.interval %></p>
  </div>
</div>


